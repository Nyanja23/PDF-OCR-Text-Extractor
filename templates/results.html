<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF OCR - Results</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #0a0b0d;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Animated background */
        .animated-bg {
            position: fixed;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
            opacity: 0.08;
            z-index: 0;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Floating orbs */
        .orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.15;
            z-index: 1;
            animation: float 25s ease-in-out infinite;
        }

        .orb-1 {
            width: 500px;
            height: 500px;
            background: #667eea;
            top: -250px;
            left: -250px;
        }

        .orb-2 {
            width: 400px;
            height: 400px;
            background: #764ba2;
            bottom: -200px;
            right: -200px;
            animation-delay: 8s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(100px, -100px) scale(1.1); }
            66% { transform: translate(-50px, 50px) scale(0.9); }
        }

        /* Header */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            padding: 1.5rem 5%;
            background: rgba(10, 11, 13, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .brand:hover {
            opacity: 0.8;
        }

        .logo {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .header-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .header-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }

        /* Main container */
        .container {
            position: relative;
            margin-top: 80px;
            padding: 2rem 5%;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            z-index: 2;
            min-height: calc(100vh - 80px);
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            animation: slideInDown 0.6s ease;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 2rem;
            gap: 2rem;
            animation: slideInDown 0.6s ease 0.1s both;
        }

        .header-left h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #ffffff 0%, #667eea 50%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .file-info-inline {
            display: flex;
            gap: 1.5rem;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.95rem;
        }

        .file-info-inline span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-actions-right {
            display: flex;
            gap: 1rem;
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .action-btn.secondary {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.2);
            box-shadow: none;
        }

        .action-btn.secondary:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .action-btn.download {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
            box-shadow: none;
        }

        .action-btn.download:hover {
            background: rgba(16, 185, 129, 0.2);
            border-color: rgba(16, 185, 129, 0.5);
        }

        /* Main content grid */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 2rem;
            animation: slideInUp 0.6s ease 0.2s both;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Text results */
        .results-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .results-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.8), transparent);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .results-title i {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-selector {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .page-selector select {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-selector select:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.08);
        }

        .page-selector select option {
            background: #1a1a1e;
            color: #ffffff;
        }

        .text-area {
            position: relative;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 1.5rem;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.9);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .text-area::-webkit-scrollbar {
            width: 8px;
        }

        .text-area::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .text-area::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.3);
            border-radius: 8px;
        }

        .text-area::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.5);
        }

        .copy-area-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .copy-area-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .copy-feedback {
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 1rem 1.5rem;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.5);
            color: #10b981;
            border-radius: 12px;
            font-weight: 600;
            animation: slideIn 0.3s ease;
            z-index: 2000;
            display: none;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .copy-feedback.show {
            display: block;
        }

        /* Sidebar */
        .sidebar {
            animation: slideInUp 0.6s ease 0.3s both;
        }

        .sidebar-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .sidebar-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.8), transparent);
        }

        .sidebar-title {
            font-weight: 700;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar-title i {
            color: #667eea;
        }

        .stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9rem;
        }

        .stat:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.6);
        }

        .stat-value {
            font-weight: 700;
            color: #667eea;
        }

        .sidebar-btn {
            width: 100%;
            padding: 0.75rem;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .sidebar-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            border-color: rgba(102, 126, 234, 0.5);
        }

        /* Loading state */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            text-align: center;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(102, 126, 234, 0.2);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .loading-subtext {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }

            .page-header {
                flex-direction: column;
            }
        }

        @media (max-width: 768px) {
            .header-actions-right {
                flex-direction: column;
                width: 100%;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
            }

            .page-header {
                gap: 1rem;
            }

            .header-left h1 {
                font-size: 1.8rem;
            }

            .file-info-inline {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .text-area {
                min-height: 300px;
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="animated-bg"></div>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>

    <header>
        <div class="header-content">
            <div class="brand" onclick="window.location.href='/dashboard'">
                <div class="logo">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <span>PDF OCR Pro</span>
            </div>
            <div class="header-actions">
                <button class="header-btn" onclick="window.location.href='/dashboard'">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="breadcrumb">
            <a onclick="window.location.href='/dashboard'">Dashboard</a>
            <i class="fas fa-chevron-right"></i>
            <span>Results</span>
        </div>

        <div class="page-header">
            <div class="header-left">
                <h1 id="filename">Invoice_2024.pdf</h1>
                <div class="file-info-inline">
                    <span><i class="fas fa-calendar"></i> Jan 15, 2024</span>
                    <span><i class="fas fa-file-lines"></i> <span id="pageCount">3</span> pages</span>
                    <span><i class="fas fa-clock"></i> <span id="processingTime">2.5</span>s</span>
                </div>
            </div>
            <div class="header-actions-right">
                <button class="action-btn download" id="downloadBtn">
                    <i class="fas fa-download"></i> Download Text
                </button>
                <button class="action-btn" id="copyAllBtn">
                    <i class="fas fa-copy"></i> Copy All
                </button>
            </div>
        </div>

        <div class="content-grid">
            <!-- Main results area -->
            <div class="results-card">
                <div class="results-header">
                    <div class="results-title">
                        <i class="fas fa-file-lines"></i>
                        Extracted Text
                    </div>
                    <div class="page-selector">
                        <label>Page:</label>
                        <select id="pageSelect" onchange="changePage(this.value)">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                        </select>
                    </div>
                </div>

                <div id="loadingState" class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Extracting text...</div>
                    <div class="loading-subtext">This may take a few moments</div>
                </div>

                <div id="contentState" style="display: none; position: relative;">
                    <button class="copy-area-btn" onclick="copyPageText()">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                    <div class="text-area" id="textContent">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.

Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Document Stats -->
                <div class="sidebar-card">
                    <div class="sidebar-title">
                        <i class="fas fa-bar-chart"></i>
                        Statistics
                    </div>
                    <div class="stat">
                        <span class="stat-label">Characters</span>
                        <span class="stat-value" id="charCount">1,524</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Words</span>
                        <span class="stat-value" id="wordCount">245</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Lines</span>
                        <span class="stat-value" id="lineCount">18</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Confidence</span>
                        <span class="stat-value" id="confidence">96%</span>
                    </div>
                </div>

                <!-- OCR Info -->
                <div class="sidebar-card">
                    <div class="sidebar-title">
                        <i class="fas fa-info-circle"></i>
                        OCR Info
                    </div>
                    <div class="stat">
                        <span class="stat-label">Language</span>
                        <span class="stat-value">English</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Status</span>
                        <span class="stat-value" style="color: #10b981;">Completed</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Engine</span>
                        <span class="stat-value">Tesseract 5.0</span>
                    </div>
                </div>

                <!-- Actions -->
                <div class="sidebar-card">
                    <div class="sidebar-title">
                        <i class="fas fa-cog"></i>
                        Actions
                    </div>
                    <button class="sidebar-btn" onclick="downloadAsText()">
                        <i class="fas fa-file-text"></i> Save as TXT
                    </button>
                    <button class="sidebar-btn" onclick="shareResults()">
                        <i class="fas fa-share"></i> Share
                    </button>
                    <button class="sidebar-btn" onclick="processAgain()" style="background: rgba(102, 126, 234, 0.05); color: #667eea; border-color: rgba(102, 126, 234, 0.1);">
                        <i class="fas fa-redo"></i> Process Again
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-feedback" id="copyFeedback">
        <i class="fas fa-check-circle"></i> Copied to clipboard!
    </div>

    <script>
        // Get job ID from URL
        const params = new URLSearchParams(window.location.search);
        const jobId = params.get('job_id');

        // Fetch and display results from API
        async function loadResults() {
            if (!jobId) {
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('contentState').innerHTML = '<p style="color: red;">Error: No job ID provided</p>';
                return;
            }

            try {
                // Fetch results from API
                const response = await fetch(`/api/ocr/result/${jobId}`);
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Display results
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('contentState').style.display = 'block';
                
                // Combine all page texts
                let fullText = '';
                if (data.results && Array.isArray(data.results)) {
                    fullText = data.results.map(result => {
                        return `--- Page ${result.page_number} ---\n${result.text}`;
                    }).join('\n\n');
                }
                
                // Update the text content
                document.getElementById('textContent').textContent = fullText || 'No text extracted';
                
                // Update stats
                updateStats();
            } catch (error) {
                console.error('Error loading results:', error);
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('contentState').innerHTML = `<p style="color: red;">Error loading results: ${error.message}</p>`;
            }
        }

        function updateStats() {
            const text = document.getElementById('textContent').textContent;
            const charCount = text.length;
            const wordCount = text.split(/\s+/).length;
            const lineCount = text.split('\n').length;

            document.getElementById('charCount').textContent = charCount.toLocaleString();
            document.getElementById('wordCount').textContent = wordCount.toLocaleString();
            document.getElementById('lineCount').textContent = lineCount;
        }

        function changePage(page) {
            // In production, fetch different page content
            document.getElementById('textContent').scrollTop = 0;
        }

        function copyPageText() {
            const text = document.getElementById('textContent').textContent;
            navigator.clipboard.writeText(text).then(() => {
                showCopyFeedback('Copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        }

        document.getElementById('copyAllBtn').addEventListener('click', () => {
            const text = document.getElementById('textContent').textContent;
            navigator.clipboard.writeText(text).then(() => {
                showCopyFeedback('All text copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        });

        function downloadAsText() {
            const text = document.getElementById('textContent').textContent;
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
            element.setAttribute('download', 'extracted_text.txt');
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            showCopyFeedback('Text file downloaded!');
        }

        document.getElementById('downloadBtn').addEventListener('click', downloadAsText);

        function shareResults() {
            const shareUrl = window.location.href;
            if (navigator.share) {
                navigator.share({
                    title: 'PDF OCR Results',
                    text: 'Check out my OCR results!',
                    url: shareUrl
                }).catch(err => console.error('Share failed:', err));
            } else {
                navigator.clipboard.writeText(shareUrl);
                showCopyFeedback('Share link copied!');
            }
        }

        function processAgain() {
            window.location.href = '/dashboard';
        }

        function showCopyFeedback(message = 'Copied to clipboard!') {
            const feedback = document.getElementById('copyFeedback');
            feedback.textContent = message;
            feedback.classList.add('show');
            
            setTimeout(() => {
                feedback.classList.remove('show');
            }, 3000);
        }

        // Initialize
        loadResults();
    </script>
</body>
</html>
